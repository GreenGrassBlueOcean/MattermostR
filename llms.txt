# MattermostR [![MattermostR website](reference/figures/MattermostR_hex.png)](https://github.com/GreenGrassBlueOcean/MattermostR)

MattermostR is an R package for interacting with the [Mattermost REST
API v4](https://api.mattermost.com/). It covers messaging, file
management, channel and team administration, reactions, bots, slash
commands, and more.

## Installation

``` r
# Install from GitHub
devtools::install_github("GreenGrassBlueOcean/MattermostR")
```

## Authentication

Authenticate with a bearer token (recommended) or username/password.
Credentials are resolved from environment variables first, then R
options.

``` r
# Token-based (recommended)
auth <- authenticate_mattermost(
  base_url = "https://your-mattermost.example.com",
  token    = "your-token"
)

# Or store credentials in environment variables to avoid passing auth everywhere:
# MATTERMOST_URL=https://your-mattermost.example.com
# MATTERMOST_TOKEN=your-token
```

## Sending Messages

### Basic message

``` r
send_mattermost_message(
  channel_id = "your-channel-id",
  message    = "Hello, Mattermost!",
  auth       = auth
)
```

### Message with priority

``` r
send_mattermost_message(
  channel_id = "your-channel-id",
  message    = "Urgent update!",
  priority   = "Urgent",   # "Normal" (default), "Important", or "Urgent"
  auth       = auth
)
```

### Reply in a thread

``` r
send_mattermost_message(
  channel_id = "your-channel-id",
  message    = "This is a thread reply.",
  root_id    = "parent-post-id",
  auth       = auth
)
```

### Attach a file or plot

``` r
library(ggplot2)

p <- ggplot(mtcars, aes(wt, mpg)) + geom_point()

send_mattermost_message(
  channel_id = "your-channel-id",
  message    = "Here is the plot.",
  plots      = list(p),
  auth       = auth
)
```

### Incoming webhooks (no auth required)

``` r
send_webhook_message(
  webhook_url = "https://your-mattermost.example.com/hooks/your-hook-id",
  message     = "Automated notification from R."
)
```

## Managing Posts

``` r
# Edit an existing post
update_post(post_id = "post-id", message = "Corrected text.", auth = auth)

# Delete a post
delete_post(post_id = "post-id", auth = auth)

# Delete all posts in a channel older than a given date
delete_old_messages(
  channel_id = "your-channel-id",
  before_date = "2024-01-01",
  auth = auth
)
```

## Reactions & Pins

``` r
# Emoji reactions
add_reaction(post_id = "post-id", emoji_name = "thumbsup", auth = auth)
get_reactions(post_id = "post-id", auth = auth)
remove_reaction(post_id = "post-id", emoji_name = "thumbsup", auth = auth)

# Pin / unpin a post
pin_post(post_id = "post-id", auth = auth)
unpin_post(post_id = "post-id", auth = auth)
```

## Searching and Retrieving Posts

``` r
# Retrieve posts from a channel (paginated)
posts <- get_channel_posts(channel_id = "your-channel-id", auth = auth)

# Search message history
results <- search_posts(
  terms       = "important update",
  team_id     = "your-team-id",
  in_channels = "your-channel-id",
  after_date  = "2024-01-01",
  auth        = auth
)
```

## Managing Channels

``` r
# List channels in a team
channels <- get_team_channels(team_id = "your-team-id", auth = auth)

# Look up a channel ID by name
channel_id <- get_channel_id_lookup(channels, name = "town-square")

# Create channels
create_channel(
  team_id      = "your-team-id",
  name         = "new-channel",
  display_name = "New Channel",
  auth         = auth
)

# Direct message or group message channel
create_direct_channel(user_ids = c("user-id-1", "user-id-2"), auth = auth)

# Delete a channel
delete_channel(channel_id = "channel-id", team_id = "your-team-id", auth = auth)

# Channel membership
add_user_to_channel(channel_id = "channel-id", user_id = "user-id", auth = auth)
add_users_to_channel(channel_id = "channel-id", user_ids = c("uid1", "uid2"), auth = auth)
get_channel_members(channel_id = "channel-id", auth = auth)
remove_channel_member(channel_id = "channel-id", user_id = "user-id", auth = auth)
```

## Teams and Users

``` r
# Teams
teams   <- get_all_teams(auth = auth)
team    <- get_team(team_id = "your-team-id", auth = auth)

# Users
me      <- get_me(auth = auth)
user    <- get_user(user_id = "user-id", auth = auth)
all_users <- get_all_users(auth = auth)

# User status
get_user_status(user_id = "user-id", auth = auth)
set_user_status(user_id = "user-id", status = "away", auth = auth)
```

## Files

``` r
# Download a file
get_mattermost_file(file_id = "file-id", dest_path = "local/file.png", auth = auth)
```

## Bots

``` r
bot <- create_bot(username = "mybot", display_name = "My Bot", auth = auth)
get_bots(auth = auth)
disable_bot(bot_user_id = bot$user_id, auth = auth)
enable_bot(bot_user_id = bot$user_id, auth = auth)
```

## Slash Commands

``` r
cmd <- create_command(
  team_id      = "your-team-id",
  trigger      = "remind",
  url          = "https://your-handler.example.com/remind",
  display_name = "Remind",
  auth         = auth
)

list_commands(team_id = "your-team-id", auth = auth)
delete_command(command_id = cmd$id, auth = auth)
```

## Error Handling

By default, HTTP errors raise a `mattermost_error` condition (stops
execution). Switch to the legacy silent mode if you prefer `NULL`
returns:

``` r
options(MattermostR.on_error = "message")
```

## License

MIT

# Package index

## Authentication

Authenticate with the Mattermost API and manage credentials.

- [`authenticate_mattermost()`](https://greengrassblueocean.github.io/MattermostR/reference/authenticate_mattermost.md)
  : Authenticate with Mattermost API
- [`clear_mattermost_credentials()`](https://greengrassblueocean.github.io/MattermostR/reference/clear_mattermost_credentials.md)
  : Clear cached Mattermost credentials from R options
- [`print(`*`<mattermost_auth>`*`)`](https://greengrassblueocean.github.io/MattermostR/reference/print.mattermost_auth.md)
  : Print a mattermost_auth object
- [`check_mattermost_auth()`](https://greengrassblueocean.github.io/MattermostR/reference/check_mattermost_auth.md)
  : Check if the object is a valid mattermost_auth object

## Messaging

Send, edit, and delete messages. Includes webhook and thread support.

- [`send_mattermost_message()`](https://greengrassblueocean.github.io/MattermostR/reference/send_mattermost_message.md)
  : Send a Message to a Mattermost Channel with Optional Attachments
- [`send_webhook_message()`](https://greengrassblueocean.github.io/MattermostR/reference/send_webhook_message.md)
  : Send a Message via a Mattermost Incoming Webhook
- [`update_post()`](https://greengrassblueocean.github.io/MattermostR/reference/update_post.md)
  : Update (Patch) an Existing Mattermost Post
- [`delete_post()`](https://greengrassblueocean.github.io/MattermostR/reference/delete_post.md)
  : Delete a specific post in Mattermost
- [`delete_old_messages()`](https://greengrassblueocean.github.io/MattermostR/reference/delete_old_messages.md)
  : Delete Messages Older Than X Days in a Mattermost Channel

## Posts & Search

Retrieve and search posts in channels.

- [`get_channel_posts()`](https://greengrassblueocean.github.io/MattermostR/reference/get_channel_posts.md)
  : Get posts from a Mattermost channel
- [`search_posts()`](https://greengrassblueocean.github.io/MattermostR/reference/search_posts.md)
  : Search for posts in Mattermost

## Reactions & Pins

Add emoji reactions and pin posts.

- [`add_reaction()`](https://greengrassblueocean.github.io/MattermostR/reference/add_reaction.md)
  : Add a Reaction to a Mattermost Post
- [`get_reactions()`](https://greengrassblueocean.github.io/MattermostR/reference/get_reactions.md)
  : Get All Reactions on a Mattermost Post
- [`remove_reaction()`](https://greengrassblueocean.github.io/MattermostR/reference/remove_reaction.md)
  : Remove a Reaction from a Mattermost Post
- [`pin_post()`](https://greengrassblueocean.github.io/MattermostR/reference/pin_post.md)
  : Pin a post to its channel
- [`unpin_post()`](https://greengrassblueocean.github.io/MattermostR/reference/unpin_post.md)
  : Unpin a post from its channel

## Channels

Create, manage, and query channels and their members.

- [`create_channel()`](https://greengrassblueocean.github.io/MattermostR/reference/create_channel.md)
  : Create a new Mattermost channel
- [`create_direct_channel()`](https://greengrassblueocean.github.io/MattermostR/reference/create_direct_channel.md)
  : Create a Direct Message or Group Message Channel
- [`delete_channel()`](https://greengrassblueocean.github.io/MattermostR/reference/delete_channel.md)
  : Delete a Mattermost channel
- [`get_channel_info()`](https://greengrassblueocean.github.io/MattermostR/reference/get_channel_info.md)
  : Get information about a Mattermost channel
- [`get_channel_id_lookup()`](https://greengrassblueocean.github.io/MattermostR/reference/get_channel_id_lookup.md)
  : Get Channel ID by Display Name or Name
- [`get_team_channels()`](https://greengrassblueocean.github.io/MattermostR/reference/get_team_channels.md)
  : Get the list of channels for a team
- [`get_channel_members()`](https://greengrassblueocean.github.io/MattermostR/reference/get_channel_members.md)
  : Get members of a channel
- [`add_user_to_channel()`](https://greengrassblueocean.github.io/MattermostR/reference/add_user_to_channel.md)
  : Add a user to a channel
- [`add_users_to_channel()`](https://greengrassblueocean.github.io/MattermostR/reference/add_users_to_channel.md)
  : Add multiple users to a channel in a single API call
- [`remove_channel_member()`](https://greengrassblueocean.github.io/MattermostR/reference/remove_channel_member.md)
  : Remove a user from a channel

## Teams

List and retrieve teams.

- [`get_all_teams()`](https://greengrassblueocean.github.io/MattermostR/reference/get_all_teams.md)
  : List all teams in Mattermost
- [`get_team()`](https://greengrassblueocean.github.io/MattermostR/reference/get_team.md)
  : Get data of a single team from its team_id

## Users

Look up users and manage their status.

- [`get_me()`](https://greengrassblueocean.github.io/MattermostR/reference/get_me.md)
  : Get information about which user is belonging to bearer key,
- [`get_user()`](https://greengrassblueocean.github.io/MattermostR/reference/get_user.md)
  : Get information about a specific Mattermost user
- [`get_user_info()`](https://greengrassblueocean.github.io/MattermostR/reference/get_user_info.md)
  : Get information about a specific Mattermost user
- [`get_all_users()`](https://greengrassblueocean.github.io/MattermostR/reference/get_all_users.md)
  : Get all known Mattermost users
- [`get_user_status()`](https://greengrassblueocean.github.io/MattermostR/reference/get_user_status.md)
  : Get user online status
- [`set_user_status()`](https://greengrassblueocean.github.io/MattermostR/reference/set_user_status.md)
  : Set user online status

## Files

Upload and download files.

- [`get_mattermost_file()`](https://greengrassblueocean.github.io/MattermostR/reference/get_mattermost_file.md)
  : Retrieve a file from Mattermost

## Bots

Create and manage bot accounts.

- [`create_bot()`](https://greengrassblueocean.github.io/MattermostR/reference/create_bot.md)
  : Create a bot account
- [`get_bot()`](https://greengrassblueocean.github.io/MattermostR/reference/get_bot.md)
  : Get a bot account
- [`get_bots()`](https://greengrassblueocean.github.io/MattermostR/reference/get_bots.md)
  : List bot accounts
- [`update_bot()`](https://greengrassblueocean.github.io/MattermostR/reference/update_bot.md)
  : Update a bot account
- [`disable_bot()`](https://greengrassblueocean.github.io/MattermostR/reference/disable_bot.md)
  : Disable a bot account
- [`enable_bot()`](https://greengrassblueocean.github.io/MattermostR/reference/enable_bot.md)
  : Enable a bot account
- [`assign_bot()`](https://greengrassblueocean.github.io/MattermostR/reference/assign_bot.md)
  : Assign a bot to a different owner

## Slash Commands

Register and manage slash commands.

- [`create_command()`](https://greengrassblueocean.github.io/MattermostR/reference/create_command.md)
  : Create a slash command
- [`get_command()`](https://greengrassblueocean.github.io/MattermostR/reference/get_command.md)
  : Get a slash command
- [`list_commands()`](https://greengrassblueocean.github.io/MattermostR/reference/list_commands.md)
  : List slash commands for a team
- [`update_command()`](https://greengrassblueocean.github.io/MattermostR/reference/update_command.md)
  : Update a slash command
- [`delete_command()`](https://greengrassblueocean.github.io/MattermostR/reference/delete_command.md)
  : Delete a slash command
- [`execute_command()`](https://greengrassblueocean.github.io/MattermostR/reference/execute_command.md)
  : Execute a slash command
- [`regen_command_token()`](https://greengrassblueocean.github.io/MattermostR/reference/regen_command_token.md)
  : Regenerate a command token

## Low-level / Developer

Direct API access and server utilities.

- [`mattermost_api_request()`](https://greengrassblueocean.github.io/MattermostR/reference/mattermost_api_request.md)
  : Make a Mattermost API Request
- [`check_mattermost_status()`](https://greengrassblueocean.github.io/MattermostR/reference/check_mattermost_status.md)
  : Check if the Mattermost server is online

